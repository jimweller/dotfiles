- defaults:
    link:
      force: true
      create: true
      relink: true

- link:
    ~/.granted/config: dotfiles/granted_config_macos
    "~/Library/Application\ Support/Code/User/settings.json": dotfiles/vscode_settings.json
    "~/Library/Application\ Support/iTerm2/DynamicProfiles/jim.json": dotfiles/iterm/jim.json
    "~/Library/Application\ Support/iTerm2/DynamicProfiles/claude.json": dotfiles/iterm/claude.json
    "~/Library/Application\ Support/iTerm2/DynamicProfiles/gemini.json": dotfiles/iterm/gemini.json
    # "~/.roo/settings/mcp_settings.json": dotfiles/roocode/mcp_settings.json
    # "~/.roo/settings/custom_modes.yaml": dotfiles/roocode/custom_modes.yaml
    # "~/Library/Application\ Support/vscode-dev-containers/templates/0jimbox/": devcontainer/vscode_template
    # "~/Library/Application\ Support/Code/User/globalStorage/rooveterinaryinc.roo-cline/settings/":
    #   glob: true
    #   path: dotfiles/roocode/*
    "~/Library/Application\ Support/Code/User/globalStorage/rooveterinaryinc.roo-cline/settings/custom_modes.yaml": dotfiles/roocode/custom_modes.yaml
    "~/Library/LaunchAgents/com.user.refreshawstoken.plist": scripts/aws-refresh-token.plist
    "~/Library/LaunchAgents/com.user.sync.plist": scripts/sync.plist
    "~/Library/LaunchAgents/com.user.colima.plist": scripts/colima-start.plist
    "~/Library/LaunchAgents/com.user.steampipe.plist": scripts/steampipe-start.plist

- shell:
    - description: Copy iTerm2 preferences (cannot symlink due to macOS cfprefsd)
      command: |
        # to refresh dotfiles
        #  cp -f ~/Library/Preferences/com.googlecode.iterm2.plist ~/.config/dotfiles/dotfiles/iterm/com.googlecode.iterm2.plist
        cp -f ~/.config/dotfiles/dotfiles/iterm/com.googlecode.iterm2.plist ~/Library/Preferences/com.googlecode.iterm2.plist
        chmod 600 ~/Library/Preferences/com.googlecode.iterm2.plist
      stderr: true
      stdout: true
    - description: Set Finder to default to list view
      command: |
        defaults write com.apple.finder FXPreferredViewStyle -string "Nlsv"
        killall Finder
      stderr: true
      stdout: true
    - description: Load launchd agents from plist files
      command: |
        for plist in ~/Library/LaunchAgents/com.user.*.plist; do
          if [ -f "$plist" ]; then
            launchctl unload "$plist" 2>/dev/null || true
            launchctl load "$plist"
          fi
        done
      stderr: true
      stdout: true
